<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DFS‚ÄëN Auto Backup ¬∑ Windows Server Talks</title>
  <link rel="stylesheet" href="assets/css/custom.css" />
  <script src="assets/js/site.js" defer></script>
</head>

<body>
  <a class="skip-link" href="#main-content">Skip to content</a>

  <header class="site-header">
    <div class="container">
      <h1>Windows Server Talks</h1>
      <p class="tagline">DFS, Active Directory, Hyper‚ÄëV, and PowerShell guides by Mohit Maurya</p>
    </div>
  </header>

  <!-- Breadcrumbs -->
  <nav class="breadcrumbs container" aria-label="Breadcrumb">
    <a href="index.html">Home</a>
    <span aria-hidden="true">‚Ä∫</span>
    <span aria-current="page">DFS‚ÄëN Auto Backup</span>
  </nav>

  <div class="layout container">
    <nav class="sidebar" aria-label="Primary">
      <h3>üìö Contents</h3>
      <ul>
        <li><a href="domain-based-dfs-n-auto-backup.html">DFS‚ÄëN Auto Backup</a></li>
        <li><a href="recover-deleted-dfs-n-links.html">Recover Deleted DFS‚ÄëN Links</a></li>
        <li><a href="index.html">‚Üê Back to Home</a></li>
      </ul>
    </nav>

    <main id="main-content" class="content" role="main">
      <h2>Domain‚ÄëBased DFS‚ÄëN Auto Backup</h2>

      <!-- Summary -->
      <div class="card">
        <h3>Summary</h3>
        <p>
          <strong>Note: </strong> Note : Only subfolders and targets can be retrieved using below not the accidently deleted complete namespace
For complete namespace rely on the backups 
        </p>
        <p>
          <strong>Scope:</strong> DFS‚ÄëN configuration data only. <strong>Not covered:</strong> DFS‚ÄëR file data.
        </p>
      </div>

      <!-- Example Image (click to zoom) -->
      <div class="card">
        <h3>Sample Output / Architecture</h3>
        <img
          class="doc-image"
          src="https://raw.githubusercontent.com/mauryamohit07/WindowsServerTalks/main/docs/images/Image1.png"
          alt="Sample DFS‚ÄëN export output screenshot" />
        <p>
          Example output generated during DFS‚ÄëN namespace export. Replace with more screenshots as needed‚Äîduplicate
          this card and update the <code>src</code> to other images under <code>docs/images/</code>.
        </p>
      </div>

      <!-- Prerequisites -->
      <div class="card">
        <h3>Prerequisites</h3>
        <ul>
          <li>Domain‚Äëjoined Windows Server</li>
          <li>DFS Management tools or <code>dfsutil</code> available</li>
          <li>PowerShell 5.1 or later</li>
          <li>Read access to Active Directory</li>
          <li>Sufficient disk space (e.g., <code>C:\DFSBackup</code>)</li>
          <li>Run PowerShell as Administrator</li>
        </ul>
      </div>

      <!-- Backup Process -->
      <div class="card">
        <h3>Automated Backup Process</h3>
        <p>
          The script below discovers DFS namespace roots in the domain, exports each to an XML file,
          and records execution details and export results.
        </p>
      </div>

      <!-- Code Block -->
      <pre><code class="language-powershell">
# ================================
# DFS Namespace Export Script
# ================================

$backupFolder = "C:\DFSBackup"
if (-not (Test-Path $backupFolder)) {
  New-Item -Path $backupFolder -ItemType Directory | Out-Null
}

$logFile = Join-Path $backupFolder "DFSExportLog.txt"
$executionLog = Join-Path $backupFolder "ExecutionLog.txt"

$previousNamespaces = @()
if (Test-Path $executionLog) {
  $previousNamespaces = Get-Content $executionLog |
    Where-Object { $_ -match "^Namespace:" } |
    ForEach-Object { ($_ -split ":")[1].Trim() }
}

Add-Content $logFile "`n--- DFS Export Started ---"

try {
  $domain = ([System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain()).Name
  Add-Content $logFile "Detected Domain: $domain"

  $rawOutput = & dfsutil /Domain:$domain /View

  $rootNames = $rawOutput |
    ForEach-Object { $_.Trim() } |
    Where-Object {
      ($_ -ne "") -and
      ($_ -notmatch "Roots on Domain") -and
      ($_ -notmatch "Done") -and
      ($_ -notmatch "processing")
    }

  foreach ($root in $rootNames) {
    $namespace = "\\$domain\$root"
    $outputFile = Join-Path $backupFolder "$root.xml"
    & dfsutil /Root:$namespace /Export:$outputFile
    Add-Content $logFile "Exported $namespace to $outputFile"
  }
}
catch {
  Add-Content $logFile "ERROR: $($_.Exception.Message)"
}
      </code></pre>
    </main>
  </div>

  <footer class="site-footer">
    <div class="container">
      <p>¬© 2026 Mohit Maurya ¬∑ Windows Server Talks</p>
    </div>
  </footer>
</body>
</html>
