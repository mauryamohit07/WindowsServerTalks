<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1">
  <title>Recover Accidentally Removed DFS Namespace Folders and Targets · Windows Server Talks</title>

  <!-- Theme color for mobile address bar -->
  <meta name="theme-color" content="#0F6CBD">

  <!-- Copilot/Fluent-styled CSS (your existing stylesheet) -->
  <link rel="stylesheet" href="https://mauryamohit07.github.io/WindowsServerTalks/assets/css/custom.css">

  <!-- Small site enhancements (loads shared header + sidebar, copy buttons, lightbox) -->
  <script src="https://mauryamohit07.github.io/WindowsServerTalks/assets/js/site.js" defer></script>
</head>
<body>
  <!-- a11y: Skip link for keyboard users -->
  <a class="skip-link" href="#main-content">Skip to content</a>

  <!-- ===== Shared Header (injected from /assets/includes/header.html) ===== -->
  <div id="header-container"></div>

  <!-- ===== Breadcrumbs (page-specific; keep here unless you template it) ===== -->
  <nav class="breadcrumbs container" aria-label="Breadcrumb">
    <a href="https://mauryamohit07.github.io/WindowsServerTalks/index.html">Home</a>
    <span aria-hidden="true">›</span>
    <span aria-current="page">Recover Deleted DFS‑N Links</span>
  </nav>

  <div class="layout container">
    <!-- ===== Shared Sidebar (injected from /assets/includes/sidebar.html) ===== -->
    <div id="sidebar-container"></div>

    <!-- ===== Main content (a little lighter grey) ===== -->
    <main id="main-content" class="content" role="main">
      <h2 class="page-title">Recover Accidentally Removed Namespace Folders and Targets</h2>
      <p class="page-subtitle">Using Active Directory Recycle Bin (DFS‑N)</p>

      <section class="summary-box">
        <h3>Summary</h3>
        <p>
          This guide explains how to <strong>recover accidentally deleted DFS namespace
          links and their targets</strong> using <strong>Active Directory Recycle Bin</strong>.
        </p>
      </section>

      <div class="callout warning">
        <strong>Important:</strong>
        Only <strong>subfolders (DFS links)</strong> and their <strong>targets</strong> can be
        recovered using this method.<br>
        <strong>Entire namespace deletion</strong> requires DFS namespace backups.
      </div>

      <div class="spacer"></div>

      <h2 class="step-title">Step 1 — Discover Deleted DFS Namespace Links</h2>
      <p class="step-desc">
        This step queries Active Directory for deleted <code>msDFS-Linkv2</code> objects,
        calculates deletion age, and displays the results for review.
      </p>

      <pre><code class="language-powershell">
 Import-Module ActiveDirectory
   
    # Define log folder
    $LogFolder = "C:\DFSlogs"
    if (!(Test-Path -Path $LogFolder)) {
        New-Item -Path $LogFolder -ItemType Directory | Out-Null
        Write-Host "Created folder: $LogFolder"
    }
   
    # Current date for age calculation
    $CurrentDate = Get-Date
   
    # Search Deleted Objects for DFS links (msDFS-Linkv2)
    $DeletedDFSObjects = Get-ADObject `
        -Filter 'ObjectClass -eq "msDFS-Linkv2" -and isDeleted -eq $true' `
        -IncludeDeletedObjects `
        -Properties DistinguishedName, Name, ObjectClass, whenChanged, ObjectGUID
   
    # Prepare data with DeletedOn and Age
    $Result = $DeletedDFSObjects | Select-Object `
        Name,
        ObjectClass,
        DistinguishedName,
        @{Name="ObjectGUID"; Expression={$_.ObjectGUID}},
        @{Name="DeletedOn"; Expression={($_.whenChanged).ToString("dd-MMM-yyyy HH:mm")}},
        @{Name="Age"; Expression={
            if ($_.whenChanged) {
                $diff = $CurrentDate - $_.whenChanged
                if ($diff.Days -ge 1) {
                    "$($diff.Days) days ago"
                } else {
                    "$([math]::Round($diff.TotalHours,1)) hours ago"
                }
            } else {
                "N/A"
            }
        }}
   
    # Show interactive grid view
    $Result | Out-GridView -Title "Deleted DFS Links Report"
   
    # Export to TXT
    $TxtFile = Join-Path $LogFolder "DFS_DeletedLinks_$(Get-Date -Format 'ddMMyyyy_HHmm').txt"
    $Result | Format-Table -AutoSize | Out-String | Set-Content $TxtFile
   
    # Export to CSV
    $CsvFile = Join-Path $LogFolder "DFS_DeletedLinks_$(Get-Date -Format 'ddMMyyyy_HHmm').csv"
    $Result | Export-Csv $CsvFile -NoTypeInformation
   
    Write-Host "Reports saved to:`nTXT: $TxtFile`nCSV: $CsvFile"
      </code></pre>

      <h2>Output be like:</h2>
      <figure>
        <img class="doc-image"
             src="https://mauryamohit07.github.io/WindowsServerTalks/assets/images/image4.png"
             alt="Out-GridView sample showing deleted DFS links">
        <figcaption>
          Out‑GridView output showing deleted DFS links with ObjectGUID and age.
        </figcaption>
      </figure>

      <figure>
        <img class="doc-image"
             src="https://mauryamohit07.github.io/WindowsServerTalks/assets/images/image5.png"
             alt="CSV export showing deleted DFS links">
        <figcaption>
          CSV export used to filter links before bulk restore.
        </figcaption>
        <figcaption>
          Also create a file in CSV format for the same.
        </figcaption>
      </figure>
      
      <h2>To restore at bulk. Admin can delete the rows as per date or age which is not required. </h2>

      <pre><code class="language-powershell">
***********************************************************************************
Import-Module ActiveDirectory

# Path to the CSV file containing ObjectGUIDs
$CsvFile = "C:\DFSlogs\DFS_DeletedLinks_29102025_0331.csv"       # file created from above 

# Path to the restore log
$LogFile = "C:\DFSlogs\RestoreLog_$(Get-Date -Format 'ddMMyyyy_HHmm').txt"

# Start log
Set-Content -Path $LogFile -Value "DFS Restore Log - $(Get-Date)`r`n"

# Import CSV and read ObjectGUID column
$Entries = Import-Csv -Path $CsvFile

foreach ($entry in $Entries) {
    $guid = $entry.ObjectGUID
    Write-Host "Restoring ObjectGUID: $guid"
    Add-Content -Path $LogFile -Value "Processing ObjectGUID: $guid"

    try {
        # Attempt restore
        Restore-ADObject -Identity $guid

        # Validate restore
        Start-Sleep -Seconds 2
        $restoredObj = Get-ADObject -Filter { ObjectGUID -eq $guid } -ErrorAction SilentlyContinue
        if ($restoredObj) {
            $succMsg = "Successfully restored: $guid"
            Write-Host $succMsg -ForegroundColor Green
            Add-Content -Path $LogFile -Value $succMsg
        } else {
            $failMsg = "Restore attempted but object not found after restore: $guid"
            Write-Host $failMsg -ForegroundColor Red
            Add-Content -Path $LogFile -Value $failMsg
        }
    }
    catch {
        $errMsg = "Failed to restore: $guid - Error: $_"
        Write-Host $errMsg -ForegroundColor Red
        Add-Content -Path $LogFile -Value $errMsg
    }
}

Write-Host "Restore process completed. Log saved to: $LogFile"

************************************************************
      </code></pre>  
      
      <h2>Above will restore and give output like&nbsp;</h2>
      <figure>
        <img class="doc-image"
             src="https://mauryamohit07.github.io/WindowsServerTalks/assets/images/image6.png"
             alt="Restored DFS links">
        <figcaption>
          Restored DFS links visible after successful recovery.
        </figcaption>
      </figure>

      <figure>
        <img class="doc-image"
             src="https://mauryamohit07.github.io/WindowsServerTalks/assets/images/image7.png"
             alt="DFS restore log output">
        <figcaption>
          Restore log confirming successful object recovery.
        </figcaption>
      </figure>
    </main>
  </div>

  <footer class="site-footer">
    <div class="container">
      <p>© 2026 Mohit Maurya · Windows Server Talks</p>
    </div>
  </footer>
</body>
</html>
